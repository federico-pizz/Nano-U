# Configuration for Nano-U Project (TensorFlow)

# Global Data settings
data:
  input_shape: [48, 64, 3]  # Height, Width, Channels (TF format: NHWC)
  num_classes: 1            # Binary segmentation
  
  # Normalization parameters (used in training and inference preprocessing)
  # Data is normalized to [-1, 1] range: (x / 255.0 - mean) / std
  normalization:
    mean: [0.5, 0.5, 0.5]
    std: [0.5, 0.5, 0.5]

  # Data splitting strategy used in preparation
  split:
    train: 0.7
    validation: 0.2
    test: 0.1

  paths:
    raw_datasets:
      - name: "tomatoes_scene1"
        images: "data/TinyAgri/Tomatoes/scene1"
        masks: "data/masks/Tomatoes/scene1"
      - name: "tomatoes_scene2"
        images: "data/TinyAgri/Tomatoes/scene2"
        masks: "data/masks/Tomatoes/scene2"
      - name: "crops_scene1"
        images: "data/TinyAgri/Crops/scene1"
        masks: "data/masks/Crops/scene1"
      - name: "crops_scene2"
        images: "data/TinyAgri/Crops/scene2"
        masks: "data/masks/Crops/scene2"
    
    processed: 
      root: "data/processed_data"
      train:
        img: "data/processed_data/train/img"
        mask: "data/processed_data/train/mask"
      val:
        img: "data/processed_data/val/img"
        mask: "data/processed_data/val/mask"
      test:
        img: "data/processed_data/test/img"
        mask: "data/processed_data/test/mask"

    models_dir: "models"


# Model Architecture Definitions
models:
  # Teacher Model (BU_Net) - UNet-like architecture
  bu_net:
    input_shape: [48, 64, 3]
    filters: [64, 128, 256, 512, 1024, 2048] # Encoder filters
    bottleneck: 2048
    decoder_filters: [1024, 512, 256, 128, 64]
    
  # Student Model (Nano_U) - Ultra-light model for embedded deployment
  nano_u:
    input_shape: [48, 64, 3]
    filters: [16, 32, 64] # Encoder filters (reduced)
    bottleneck: 64
    decoder_filters: [32, 16]


# Training Hyperparameters
training:
  # General settings
  seed: 24
  
  # Teacher (BU_Net) training config
  bu_net:
    epochs: 100
    batch_size: 16
    learning_rate: 1e-4
    weight_decay: 1e-3
    optimizer: "adamw"
    loss: "binary_crossentropy" 
    augment: true

  # Student (Nano_U) training config
  nano_u:
    epochs: 100 
    batch_size: 8
    learning_rate: 1e-4
    weight_decay: 1e-3
    optimizer: "adamw"
    loss: "binary_crossentropy"
    augment: true
    
    # Knowledge Distillation settings
    distillation:
      enabled: true
      teacher_weights: "models/bu_net.keras"
      alpha: 0.3        # Weight for student loss (1-alpha for teacher loss); lower => more teacher influence
      temperature: 4.0  # Higher temperature to soften teacher distribution for richer distillation gradients


# NAS (Neural Architecture Search) Monitoring Configuration
# Callback-based monitoring for analyzing model efficiency during training
nas:
  # Enable NAS monitoring (can be overridden via CLI --enable-nas)
  enabled: false
  
  # Logging configuration
  log_dir: "logs/nas"           # Directory for TensorBoard logs
  csv_path: null                # CSV output path (null = auto-generate based on model name)
  
  # Monitoring frequency
  log_freq: "epoch"             # Options: "epoch" or "batch"
  monitor_batch_freq: 10        # When log_freq="batch", monitor every N batches
  
  # Analysis thresholds for automated recommendations
  thresholds:
    high_redundancy: 0.7        # Redundancy above this suggests overparameterization
    low_redundancy: 0.3         # Redundancy below this indicates good utilization
    high_correlation: 0.5       # Correlation above this suggests feature redundancy
    poor_conditioning: 1.0e6    # Condition number above this indicates numerical issues
  
  # Visualization settings (used by plot_nas_metrics.py)
  visualization:
    dpi: 300                    # Plot resolution
    figure_format: "png"        # Output format: png, pdf, svg
    color_scheme: "tab10"       # Matplotlib colormap for comparisons


# Quantization settings (TFLite)
quantization:
  method: "dynamic_range" # or "full_integer"
  representative_dataset_size: 100
  input_type: "int8"
  output_type: "int8"
  supported_ops:
    - "TFLITE_BUILTINS_INT8"
    - "SELECT_TF_OPS"
